<?php

require_once('./conexion.php');
require_once('./parametros.php');
require_once('./usuario.php');

class UsuarioDAO
{

    private $conexion;

    public function __construct()
    {
        $this->conexion = Conexion::getInstancia();
    }

    public function getUserByDni($dni)
    {
        try {
            $conexionMySql = $this->conexion->getConexion();
            $query = Consultas::GETBYDNI;
            $stmt = mysqli_prepare($conexionMySql, $query);
            mysqli_stmt_bind_param($stmt, "s", $dni);
            mysqli_stmt_execute($stmt);
            $resultado = mysqli_stmt_get_result($stmt);

            if ($fila = mysqli_fetch_assoc($resultado)) {
                $usuario = new Usuario(
                    $fila['dni'],
                    $fila['nombre'],
                    $fila['clave'],
                    $fila['tfno']
                );
            }

            return $usuario;
        } catch (Exception $e) {
            throw new Exception("Error: " . $e->getMessage());
        } finally {
            $this->conexion->closeConexion();
        }
    }

    public function getAllUsers(){

        try {
            $conexionMySql = $this->conexion->getConexion();
        $query = Consultas::GETALL;
        $stmt = mysqli_prepare($conexionMySql,$query);
        mysqli_stmt_execute($stmt);
        $resultado = mysqli_stmt_get_result($stmt);

        $usuarios = [];

        while($fila = mysqli_fetch_assoc($resultado)){
            $usuario = new Usuario(
                $fila['dni'],
                $fila['nombre'],
                $fila['calve'],
                $fila['tfno']
            );

            $usuarios[] = $usuario;
        }
        } catch (Exception $e) {
            throw new Exception("Error al obtener todos los usuarios: ".$e->getMessage());
        }finally{
            $this->conexion->closeConexion();
        }
        
    }



}
